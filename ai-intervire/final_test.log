[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------------< com.can:ai-assistant >------------------------
[INFO] Building ai-assistant 0.0.1-SNAPSHOT
[INFO]   from pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] >>> spring-boot:3.2.3:run (default-cli) > test-compile @ ai-assistant >>>
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ ai-assistant ---
[INFO] Copying 1 resource from src/main/resources to target/classes
[INFO] Copying 3 resources from src/main/resources to target/classes
[INFO] 
[INFO] --- compiler:3.11.0:compile (default-compile) @ ai-assistant ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- resources:3.3.1:testResources (default-testResources) @ ai-assistant ---
[INFO] skip non existing resourceDirectory /Users/can/Documents/ai/ai-intervire/src/test/resources
[INFO] 
[INFO] --- compiler:3.11.0:testCompile (default-testCompile) @ ai-assistant ---
[INFO] No sources to compile
[INFO] 
[INFO] <<< spring-boot:3.2.3:run (default-cli) < test-compile @ ai-assistant <<<
[INFO] 
[INFO] 
[INFO] --- spring-boot:3.2.3:run (default-cli) @ ai-assistant ---
[INFO] Attaching agents: []

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
[32m :: Spring Boot :: [39m              [2m (v3.2.3)[0;39m

16:10:45.705 [main] INFO  c.c.a.AiAssistantApplication - Starting AiAssistantApplication using Java 23.0.2 with PID 4402 (/Users/can/Documents/ai/ai-intervire/target/classes started by can in /Users/can/Documents/ai/ai-intervire)
16:10:45.705 [main] INFO  c.c.a.AiAssistantApplication - No active profile set, falling back to 1 default profile: "default"
16:10:46.085 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8081 (http)
16:10:46.091 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
16:10:46.091 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
16:10:46.114 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
16:10:46.115 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 385 ms
16:10:46.256 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page template: index
16:10:46.340 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8081 (http) with context path ''
16:10:46.343 [main] INFO  c.c.a.AiAssistantApplication - Started AiAssistantApplication in 0.811 seconds (process running for 0.955)
16:10:46.344 [main] INFO  c.c.a.AiAssistantApplication - ===========================================
16:10:46.344 [main] INFO  c.c.a.AiAssistantApplication - AI智能助手启动成功！
16:10:46.344 [main] INFO  c.c.a.AiAssistantApplication - 访问地址: http://localhost:8081
16:10:46.345 [main] INFO  c.c.a.AiAssistantApplication - 健康检查: http://localhost:8081/api/ai/health
16:10:46.345 [main] INFO  c.c.a.AiAssistantApplication - ===========================================
16:11:06.288 [http-nio-8081-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
16:11:06.288 [http-nio-8081-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
16:11:06.290 [http-nio-8081-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
16:11:06.355 [http-nio-8081-exec-1] INFO  c.c.a.controller.StreamController - === 流式聊天请求开始 ===
16:11:06.355 [http-nio-8081-exec-1] INFO  c.c.a.controller.StreamController - 会话ID: final_test
16:11:06.355 [http-nio-8081-exec-1] INFO  c.c.a.controller.StreamController - 用户消息: 你好，我叫赵六
16:11:06.355 [http-nio-8081-exec-1] INFO  c.c.a.controller.StreamController - 深度思考: false
16:11:06.355 [http-nio-8081-exec-1] INFO  c.c.a.controller.StreamController - 超时配置: 300000ms
16:11:06.357 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🤖 智能体执行开始
16:11:06.357 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 📋 执行预处理阶段
16:11:06.357 [pool-2-thread-1] INFO  c.c.a.service.RequestPreprocessor - 🔄 开始预处理请求
16:11:06.357 [pool-2-thread-1] INFO  c.c.a.service.RequestPreprocessor - ✅ 请求预处理完成 - 会话: final_test, 路由: 简单对话, 耗时: 0ms
16:11:06.357 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 预处理完成 - 路由: 简单对话, 耗时: 0ms
16:11:06.357 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🧠 执行内存加载阶段 - 会话: final_test
16:11:06.357 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - 🧠 加载上下文 - 会话: final_test
16:11:06.358 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - ✅ 上下文加载完成 - 会话: final_test, 历史记录: 0, 压缩后: 0, 耗时: 1ms
16:11:06.358 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 内存加载完成 - 耗时: 1ms
16:11:06.358 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 📝 执行响应生成阶段 - 会话: final_test
16:11:06.358 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 📝 响应生成开始 - 会话: final_test, 路由: 简单对话
16:11:06.358 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 🎯 生成策略: 简单生成 - 会话: final_test
16:11:06.358 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 💬 执行简单生成
16:11:06.359 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 🔍 开始验证流式调用参数 - 会话: unknown
16:11:06.359 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 📡 开始流式AI模型调用 - 会话: unknown, 模型: qwen-turbo, 消息数: 2
16:11:06.728 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 🌐 HTTP响应已接收 - 会话: unknown, 响应时间: 361ms, 状态码: 200
16:11:06.729 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - ⚡ 首个数据块已接收 - 会话: unknown, 首块延迟: 362ms
16:11:07.722 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 🏁 流式响应结束标记 - 会话: unknown, 总块数: 10
16:11:07.723 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - ✅ 流式响应处理完成 - 会话: unknown, 总耗时: 1364ms, 总块数: 10, 首块延迟: 362ms, 消息长度: 26字符
16:11:07.727 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - ✅ ResponseCollector保存最终响应 - 长度: 26, 内容: 你好，赵六！很高兴认识你。有什么我可以帮你的吗？😊...
16:11:07.730 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - ✅ 响应生成完成 - 会话: final_test, 策略: 简单生成, 耗时: 1372ms
16:11:07.730 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 响应生成完成 - 耗时: 1372ms
16:11:07.730 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 💾 执行内存保存阶段 - 会话: final_test
16:11:07.730 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - 💾 保存上下文 - 会话: final_test
16:11:07.732 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - 💾 保存AI响应 - 会话: final_test, 响应长度: 26, 内容: 你好，赵六！很高兴认识你。有什么我可以帮你的吗？😊...
16:11:07.732 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - ✅ 上下文保存完成 - 会话: final_test, 耗时: 2ms
16:11:07.732 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 内存保存完成 - 耗时: 2ms
16:11:07.732 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🔄 执行后处理阶段 - 会话: final_test
16:11:07.733 [pool-2-thread-1] INFO  c.c.a.service.PostProcessor - 🔄 后处理开始 - 会话: final_test
16:11:07.737 [http-nio-8081-exec-2] INFO  c.c.a.controller.StreamController - ✅ 流式聊天完成 - 会话: final_test, 总处理时长: 1382ms
16:11:07.737 [http-nio-8081-exec-2] INFO  c.c.a.controller.StreamController - === 流式聊天请求结束 ===
16:11:07.738 [pool-2-thread-1] ERROR c.c.a.service.PostProcessor - ❌ 后处理失败 - 会话: final_test, 错误: ResponseBodyEmitter has already completed, 耗时: 5ms
16:11:07.738 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 后处理完成 - 耗时: 5ms
16:11:07.738 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🎉 智能体执行完成 - 会话: final_test, 总耗时: 1381ms
16:11:18.252 [http-nio-8081-exec-3] INFO  c.c.a.controller.StreamController - === 流式聊天请求开始 ===
16:11:18.252 [http-nio-8081-exec-3] INFO  c.c.a.controller.StreamController - 会话ID: final_test
16:11:18.252 [http-nio-8081-exec-3] INFO  c.c.a.controller.StreamController - 用户消息: 我刚才说我叫什么名字？
16:11:18.252 [http-nio-8081-exec-3] INFO  c.c.a.controller.StreamController - 深度思考: false
16:11:18.252 [http-nio-8081-exec-3] INFO  c.c.a.controller.StreamController - 超时配置: 300000ms
16:11:18.252 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🤖 智能体执行开始
16:11:18.253 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 📋 执行预处理阶段
16:11:18.253 [pool-2-thread-1] INFO  c.c.a.service.RequestPreprocessor - 🔄 开始预处理请求
16:11:18.253 [pool-2-thread-1] INFO  c.c.a.service.RequestPreprocessor - ✅ 请求预处理完成 - 会话: final_test, 路由: 标准对话, 耗时: 0ms
16:11:18.253 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 预处理完成 - 路由: 标准对话, 耗时: 0ms
16:11:18.253 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🧠 执行内存加载阶段 - 会话: final_test
16:11:18.253 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - 🧠 加载上下文 - 会话: final_test
16:11:18.255 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - ✅ 上下文加载完成 - 会话: final_test, 历史记录: 2, 压缩后: 2, 耗时: 2ms
16:11:18.255 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 内存加载完成 - 耗时: 2ms
16:11:18.255 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 📝 执行响应生成阶段 - 会话: final_test
16:11:18.255 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 📝 响应生成开始 - 会话: final_test, 路由: 标准对话
16:11:18.255 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 🎯 生成策略: 上下文感知生成 - 会话: final_test
16:11:18.255 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 🧠 执行上下文感知生成
16:11:18.255 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 🔍 添加历史上下文 - 会话: final_test, 压缩后消息数: 2
16:11:18.255 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 📝 历史消息 - 角色: user, 内容: 你好，我叫赵六...
16:11:18.255 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 📝 历史消息 - 角色: assistant, 内容: 你好，赵六！很高兴认识你。有什么我可以帮你的吗？😊...
16:11:18.256 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 🔍 开始验证流式调用参数 - 会话: final_test
16:11:18.256 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 📡 开始流式AI模型调用 - 会话: final_test, 模型: qwen-turbo, 消息数: 4
16:11:18.474 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 🌐 HTTP响应已接收 - 会话: final_test, 响应时间: 218ms, 状态码: 200
16:11:18.474 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - ⚡ 首个数据块已接收 - 会话: final_test, 首块延迟: 218ms
16:11:19.560 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 🏁 流式响应结束标记 - 会话: final_test, 总块数: 11
16:11:19.561 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - ✅ 流式响应处理完成 - 会话: final_test, 总耗时: 1305ms, 总块数: 11, 首块延迟: 218ms, 消息长度: 23字符
16:11:19.562 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - ✅ ResponseCollector保存最终响应 - 长度: 23, 内容: 你刚才说你叫赵六。😊 有什么需要我帮忙的吗？...
16:11:19.562 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - ✅ 响应生成完成 - 会话: final_test, 策略: 上下文感知生成, 耗时: 1307ms
16:11:19.562 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 响应生成完成 - 耗时: 1307ms
16:11:19.563 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 💾 执行内存保存阶段 - 会话: final_test
16:11:19.563 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - 💾 保存上下文 - 会话: final_test
16:11:19.563 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - 💾 保存AI响应 - 会话: final_test, 响应长度: 23, 内容: 你刚才说你叫赵六。😊 有什么需要我帮忙的吗？...
16:11:19.563 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - ✅ 上下文保存完成 - 会话: final_test, 耗时: 0ms
16:11:19.563 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 内存保存完成 - 耗时: 0ms
16:11:19.563 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🔄 执行后处理阶段 - 会话: final_test
16:11:19.563 [http-nio-8081-exec-4] INFO  c.c.a.controller.StreamController - ✅ 流式聊天完成 - 会话: final_test, 总处理时长: 1311ms
16:11:19.563 [pool-2-thread-1] INFO  c.c.a.service.PostProcessor - 🔄 后处理开始 - 会话: final_test
16:11:19.563 [http-nio-8081-exec-4] INFO  c.c.a.controller.StreamController - === 流式聊天请求结束 ===
16:11:19.563 [pool-2-thread-1] ERROR c.c.a.service.PostProcessor - ❌ 后处理失败 - 会话: final_test, 错误: ResponseBodyEmitter has already completed, 耗时: 0ms
16:11:19.563 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 后处理完成 - 耗时: 0ms
16:11:19.564 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🎉 智能体执行完成 - 会话: final_test, 总耗时: 1312ms
16:11:45.887 [http-nio-8081-exec-6] INFO  c.c.a.controller.StreamController - === 流式聊天请求开始 ===
16:11:45.887 [http-nio-8081-exec-6] INFO  c.c.a.controller.StreamController - 会话ID: new_session
16:11:45.887 [http-nio-8081-exec-6] INFO  c.c.a.controller.StreamController - 用户消息: 我之前说我叫什么名字？
16:11:45.887 [http-nio-8081-exec-6] INFO  c.c.a.controller.StreamController - 深度思考: false
16:11:45.887 [http-nio-8081-exec-6] INFO  c.c.a.controller.StreamController - 超时配置: 300000ms
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🤖 智能体执行开始
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 📋 执行预处理阶段
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.RequestPreprocessor - 🔄 开始预处理请求
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.RequestPreprocessor - ✅ 请求预处理完成 - 会话: new_session, 路由: 标准对话, 耗时: 0ms
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 预处理完成 - 路由: 标准对话, 耗时: 0ms
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🧠 执行内存加载阶段 - 会话: new_session
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - 🧠 加载上下文 - 会话: new_session
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - ✅ 上下文加载完成 - 会话: new_session, 历史记录: 0, 压缩后: 0, 耗时: 0ms
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 内存加载完成 - 耗时: 0ms
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 📝 执行响应生成阶段 - 会话: new_session
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 📝 响应生成开始 - 会话: new_session, 路由: 标准对话
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 🎯 生成策略: 上下文感知生成 - 会话: new_session
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - 🧠 执行上下文感知生成
16:11:45.887 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - ⚠️ 没有历史上下文 - 会话: new_session
16:11:45.887 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 🔍 开始验证流式调用参数 - 会话: new_session
16:11:45.887 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 📡 开始流式AI模型调用 - 会话: new_session, 模型: qwen-turbo, 消息数: 2
16:11:46.094 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 🌐 HTTP响应已接收 - 会话: new_session, 响应时间: 206ms, 状态码: 200
16:11:46.095 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - ⚡ 首个数据块已接收 - 会话: new_session, 首块延迟: 207ms
16:11:47.283 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - 🏁 流式响应结束标记 - 会话: new_session, 总块数: 12
16:11:47.284 [pool-2-thread-1] INFO  c.can.aiassistant.service.AiService - ✅ 流式响应处理完成 - 会话: new_session, 总耗时: 1397ms, 总块数: 12, 首块延迟: 207ms, 消息长度: 38字符
16:11:47.285 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - ✅ ResponseCollector保存最终响应 - 长度: 38, 内容: 你之前没有告诉过我你的名字。如果你愿意的话，可以告诉我你的名字，我会记住它！...
16:11:47.286 [pool-2-thread-1] INFO  c.c.a.service.ResponseGenerator - ✅ 响应生成完成 - 会话: new_session, 策略: 上下文感知生成, 耗时: 1399ms
16:11:47.286 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 响应生成完成 - 耗时: 1399ms
16:11:47.286 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 💾 执行内存保存阶段 - 会话: new_session
16:11:47.286 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - 💾 保存上下文 - 会话: new_session
16:11:47.287 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - 💾 保存AI响应 - 会话: new_session, 响应长度: 38, 内容: 你之前没有告诉过我你的名字。如果你愿意的话，可以告诉我你的名字，我会记住它！...
16:11:47.287 [pool-2-thread-1] INFO  c.c.a.service.MemoryManager - ✅ 上下文保存完成 - 会话: new_session, 耗时: 1ms
16:11:47.287 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 内存保存完成 - 耗时: 1ms
16:11:47.287 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🔄 执行后处理阶段 - 会话: new_session
16:11:47.287 [pool-2-thread-1] INFO  c.c.a.service.PostProcessor - 🔄 后处理开始 - 会话: new_session
16:11:47.287 [pool-2-thread-1] ERROR c.c.a.service.PostProcessor - ❌ 后处理失败 - 会话: new_session, 错误: ResponseBodyEmitter has already completed, 耗时: 0ms
16:11:47.287 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - ✅ 后处理完成 - 耗时: 0ms
16:11:47.287 [pool-2-thread-1] INFO  c.c.a.service.AgentExecutor - 🎉 智能体执行完成 - 会话: new_session, 总耗时: 1400ms
16:11:47.287 [http-nio-8081-exec-7] INFO  c.c.a.controller.StreamController - ✅ 流式聊天完成 - 会话: new_session, 总处理时长: 1400ms
16:11:47.287 [http-nio-8081-exec-7] INFO  c.c.a.controller.StreamController - === 流式聊天请求结束 ===
