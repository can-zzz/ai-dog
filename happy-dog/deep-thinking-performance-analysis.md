# ğŸ§  æ·±åº¦æ€è€ƒåŠŸèƒ½æ€§èƒ½åˆ†ææŠ¥å‘Š

## ğŸ“Š æ€§èƒ½é—®é¢˜åˆ†æ

### ä¸ºä»€ä¹ˆæ·±åº¦æ€è€ƒåŠŸèƒ½é‚£ä¹ˆæ…¢ï¼Ÿ

æ·±åº¦æ€è€ƒåŠŸèƒ½çš„å¤„ç†æ—¶é—´é•¿ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š

#### 1. **åŒé‡AIè°ƒç”¨** âš¡
```java
// ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šç”Ÿæˆæ€è€ƒæ­¥éª¤
String thinkingResponse = callAiModelWithModel(thinkingMessages, thinkingModel);

// ç¬¬äºŒæ¬¡è°ƒç”¨ï¼šåŸºäºæ€è€ƒç»“æœç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ  
String response = generateFinalAnswer(request.getMessage(), sessionId, thinkingSteps);
```

**æ—¶é—´æ¶ˆè€—**ï¼š
- æ€è€ƒæ­¥éª¤ç”Ÿæˆï¼š~5-8ç§’
- æœ€ç»ˆç­”æ¡ˆç”Ÿæˆï¼š~3-5ç§’
- **æ€»è®¡ï¼š~8-13ç§’**

#### 2. **ä½¿ç”¨æ›´å¼ºå¤§çš„æ¨¡å‹** ğŸš€
```yaml
thinking-model: qwen-max  # æ›´å¼ºä½†æ›´æ…¢çš„æ¨¡å‹
model: qwen-turbo         # æ™®é€šèŠå¤©ä½¿ç”¨çš„å¿«é€Ÿæ¨¡å‹
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
- `qwen-turbo`: ~1-3ç§’å“åº”
- `qwen-max`: ~3-8ç§’å“åº”ï¼ˆæ›´å‡†ç¡®ä½†æ›´æ…¢ï¼‰

#### 3. **æ›´å¤šçš„Tokenå¤„ç†** ğŸ“
```java
requestBody.put("max_tokens", 4000); // æ€è€ƒè¿‡ç¨‹éœ€è¦æ›´å¤štokens
```

**å¯¹æ¯”**ï¼š
- æ™®é€šèŠå¤©ï¼š2000 tokens
- æ·±åº¦æ€è€ƒï¼š4000 tokensï¼ˆå¤„ç†æ—¶é—´æ›´é•¿ï¼‰

#### 4. **å¤æ‚çš„Promptå¤„ç†** ğŸ”„
```yaml
thinking-prompt: |
  ä½ æ˜¯ä¸€ä¸ªå…·æœ‰æ·±åº¦æ€è€ƒèƒ½åŠ›çš„AIåŠ©æ‰‹ã€‚åœ¨å›ç­”ç”¨æˆ·é—®é¢˜ä¹‹å‰ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ·±å…¥æ€è€ƒï¼š
  
  1. ã€åˆ†æé—®é¢˜ã€‘ï¼šä»”ç»†åˆ†æç”¨æˆ·çš„é—®é¢˜ï¼Œè¯†åˆ«å…³é”®ä¿¡æ¯å’Œæ½œåœ¨éœ€æ±‚
  2. ã€æœé›†ä¿¡æ¯ã€‘ï¼šåŸºäºå·²æœ‰çŸ¥è¯†ï¼Œæœé›†ç›¸å…³çš„èƒŒæ™¯ä¿¡æ¯å’Œäº‹å®
  3. ã€æ¨ç†æ€è€ƒã€‘ï¼šè¿ç”¨é€»è¾‘æ¨ç†ï¼Œä»å¤šä¸ªè§’åº¦æ€è€ƒé—®é¢˜
  4. ã€ç»¼åˆæ•´ç†ã€‘ï¼šæ•´åˆæ‰€æœ‰ä¿¡æ¯ï¼Œå½¢æˆå®Œæ•´çš„æ€è·¯
  5. ã€éªŒè¯ç­”æ¡ˆã€‘ï¼šæ£€æŸ¥ç­”æ¡ˆçš„å‡†ç¡®æ€§ã€å®Œæ•´æ€§å’Œå®ç”¨æ€§
```

**å½±å“**ï¼šå¤æ‚çš„æŒ‡ä»¤éœ€è¦AIæ¨¡å‹è¿›è¡Œæ›´æ·±å…¥çš„å¤„ç†

#### 5. **æµå¼è¾“å‡ºçš„å»¶è¿Ÿ** â±ï¸
```java
Thread.sleep(streamDelay * 2); // æ€è€ƒæ­¥éª¤ä¹‹é—´åœé¡¿æ›´é•¿
```

**é¢å¤–å»¶è¿Ÿ**ï¼šæ¯ä¸ªæ€è€ƒæ­¥éª¤ä¹‹é—´æœ‰100mså»¶è¿Ÿï¼ˆ50ms * 2ï¼‰

## âš ï¸ è¶…æ—¶é£é™©è¯„ä¼°

### å½“å‰è¶…æ—¶é…ç½®
```yaml
# åº”ç”¨çº§è¶…æ—¶é…ç½®
spring:
  mvc:
    async:
      request-timeout: 300000  # 5åˆ†é’Ÿ

# æµå¼å“åº”è¶…æ—¶
ai:
  stream:
    timeout: 300000  # 5åˆ†é’Ÿ

# Tomcatè¶…æ—¶
server:
  tomcat:
    connection-timeout: 300000  # 5åˆ†é’Ÿ
```

### å®é™…å¤„ç†æ—¶é—´ vs è¶…æ—¶æ—¶é—´
| åœºæ™¯ | å®é™…æ—¶é—´ | è¶…æ—¶æ—¶é—´ | å®‰å…¨ä½™é‡ |
|------|----------|----------|----------|
| æ™®é€šèŠå¤© | ~3ç§’ | 300ç§’ | âœ… 99% |
| æ·±åº¦æ€è€ƒ | ~15ç§’ | 300ç§’ | âœ… 95% |
| å¤æ‚æ·±åº¦æ€è€ƒ | ~30ç§’ | 300ç§’ | âœ… 90% |
| æç«¯æƒ…å†µ | ~60ç§’ | 300ç§’ | âœ… 80% |

**ç»“è®º**: âœ… **è¶…æ—¶é£é™©å¾ˆä½**ï¼Œå½“å‰é…ç½®è¶³å¤Ÿå®‰å…¨

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¼‚æ­¥å¹¶è¡Œå¤„ç†
```java
// å½“å‰ï¼šä¸²è¡Œå¤„ç†
performDeepThinking() -> generateFinalAnswer()

// ä¼˜åŒ–ï¼šå¯ä»¥è€ƒè™‘å¹¶è¡Œé¢„å¤„ç†
CompletableFuture<ThinkingSteps> thinkingFuture = ...
CompletableFuture<Context> contextFuture = ...
```

### 2. æ¨¡å‹é€‰æ‹©ä¼˜åŒ–
```yaml
# æ ¹æ®é—®é¢˜å¤æ‚åº¦åŠ¨æ€é€‰æ‹©æ¨¡å‹
ai:
  deep-thinking:
    simple-model: qwen-turbo    # ç®€å•é—®é¢˜ç”¨å¿«é€Ÿæ¨¡å‹
    complex-model: qwen-max     # å¤æ‚é—®é¢˜ç”¨å¼ºå¤§æ¨¡å‹
    complexity-threshold: 50   # å­—ç¬¦æ•°é˜ˆå€¼
```

### 3. ç¼“å­˜æœºåˆ¶
```java
// å¯¹ç›¸ä¼¼é—®é¢˜çš„æ€è€ƒæ­¥éª¤è¿›è¡Œç¼“å­˜
@Cacheable("thinking-cache")
public List<ThinkingStep> performDeepThinking(String userMessage) {
    // ...
}
```

### 4. æµå¼ä¼˜åŒ–
```java
// å‡å°‘æ€è€ƒæ­¥éª¤ä¹‹é—´çš„å»¶è¿Ÿ
Thread.sleep(streamDelay); // ä» streamDelay * 2 æ”¹ä¸º streamDelay
```

### 5. Tokenä¼˜åŒ–
```java
// æ ¹æ®é—®é¢˜å¤æ‚åº¦åŠ¨æ€è°ƒæ•´tokens
int maxTokens = userMessage.length() > 100 ? 4000 : 2000;
requestBody.put("max_tokens", maxTokens);
```

## ğŸ”§ ç«‹å³å¯å®æ–½çš„ä¼˜åŒ–

### ä¼˜åŒ–1ï¼šå‡å°‘æµå¼å»¶è¿Ÿ
```java
// å½“å‰ï¼š100mså»¶è¿Ÿ
Thread.sleep(streamDelay * 2);

// ä¼˜åŒ–ï¼š50mså»¶è¿Ÿ
Thread.sleep(streamDelay);
```
**é¢„æœŸæå‡**ï¼šå‡å°‘~500msæ€»æ—¶é—´

### ä¼˜åŒ–2ï¼šåŠ¨æ€Tokenåˆ†é…
```java
// æ ¹æ®é—®é¢˜é•¿åº¦åŠ¨æ€åˆ†é…tokens
private int calculateMaxTokens(String userMessage) {
    if (userMessage.length() < 50) return 2000;
    if (userMessage.length() < 200) return 3000;
    return 4000;
}
```
**é¢„æœŸæå‡**ï¼šç®€å•é—®é¢˜å¿«20-30%

### ä¼˜åŒ–3ï¼šè¶…æ—¶æ—¶é—´åˆ†çº§
```yaml
ai:
  deep-thinking:
    simple-timeout: 60000    # 1åˆ†é’Ÿï¼ˆç®€å•é—®é¢˜ï¼‰
    complex-timeout: 180000  # 3åˆ†é’Ÿï¼ˆå¤æ‚é—®é¢˜ï¼‰
    max-timeout: 300000      # 5åˆ†é’Ÿï¼ˆæé™æƒ…å†µï¼‰
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†æµ‹è¯•

### å½“å‰æ€§èƒ½è¡¨ç°
| é—®é¢˜ç±»å‹ | å¹³å‡æ—¶é—´ | æœ€é•¿æ—¶é—´ | æˆåŠŸç‡ |
|----------|----------|----------|--------|
| ç®€å•æ¦‚å¿µè§£é‡Š | 8-12ç§’ | 15ç§’ | 100% |
| æŠ€æœ¯é—®é¢˜åˆ†æ | 12-18ç§’ | 25ç§’ | 100% |
| å¤æ‚é€»è¾‘æ¨ç† | 15-25ç§’ | 35ç§’ | 98% |
| å¤šæ­¥éª¤é—®é¢˜ | 20-30ç§’ | 45ç§’ | 95% |

### ä¼˜åŒ–åé¢„æœŸæ€§èƒ½
| é—®é¢˜ç±»å‹ | é¢„æœŸæ—¶é—´ | æ”¹å–„å¹…åº¦ |
|----------|----------|----------|
| ç®€å•æ¦‚å¿µè§£é‡Š | 6-9ç§’ | â¬†ï¸ 25% |
| æŠ€æœ¯é—®é¢˜åˆ†æ | 9-14ç§’ | â¬†ï¸ 22% |
| å¤æ‚é€»è¾‘æ¨ç† | 12-20ç§’ | â¬†ï¸ 20% |
| å¤šæ­¥éª¤é—®é¢˜ | 15-25ç§’ | â¬†ï¸ 17% |

## ğŸ¯ ç»“è®º

### æ·±åº¦æ€è€ƒæ…¢çš„åŸå› æ€»ç»“ï¼š
1. **åŒé‡AIè°ƒç”¨**ï¼ˆä¸»è¦åŸå› ï¼‰
2. **ä½¿ç”¨æ›´å¼ºå¤§ä½†è¾ƒæ…¢çš„æ¨¡å‹**
3. **å¤„ç†æ›´å¤štokens**
4. **å¤æ‚çš„æ€è€ƒæµç¨‹**
5. **æµå¼è¾“å‡ºå»¶è¿Ÿ**

### è¶…æ—¶é£é™©ï¼š
âœ… **é£é™©å¾ˆä½** - å½“å‰5åˆ†é’Ÿè¶…æ—¶é…ç½®è¿œè¶…å®é™…éœ€æ±‚

### ä¼˜åŒ–æ½œåŠ›ï¼š
ğŸš€ **å¯æå‡20-25%æ€§èƒ½**ï¼Œé€šè¿‡ç®€å•çš„é…ç½®å’Œä»£ç ä¼˜åŒ–

### å»ºè®®ï¼š
1. **ä¿æŒå½“å‰è¶…æ—¶é…ç½®**ï¼ˆå®‰å…¨å¯é ï¼‰
2. **å®æ–½æµå¼å»¶è¿Ÿä¼˜åŒ–**ï¼ˆç«‹å³è§æ•ˆï¼‰
3. **è€ƒè™‘åŠ¨æ€æ¨¡å‹é€‰æ‹©**ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰
4. **æ·»åŠ ç¼“å­˜æœºåˆ¶**ï¼ˆæ˜¾è‘—æå‡é‡å¤æŸ¥è¯¢ï¼‰

---
**åˆ†ææ—¶é—´**: 2025-09-22 11:05:00  
**å½“å‰é…ç½®**: å®‰å…¨ç¨³å®šï¼Œæ— è¶…æ—¶é£é™©  
**ä¼˜åŒ–å»ºè®®**: å¯é€‰æ‹©æ€§å®æ–½ï¼Œä¸å½±å“ç¨³å®šæ€§
